{% set active_page = "recipes" %}

{% extends "base_template.html" %}

{% block title %}Reseptit{% endblock %}

{% block main %}

<div class="container">
  <div class="row">
    <div class="col">

      {% with messages = get_flashed_messages() %}
      {% if messages %}
      {% for message in messages %}
      <div class="alert alert-success" role="alert">
        {{ message }}
      </div>
      {% endfor %}
      {% endif %}
      {% endwith %}


      {% if query == "" %}
      <p>Näytetään kaikki sovelluksen reseptit ({{ count }} kpl)</p>
      {% else %}
      <p>Näytetään tulokset haulla {{ query }} ({{ count }} kpl)</p>
      {% endif %}
    </div>
  </div>

  <div class="row">
    <div class="col">
      <form action="/recipes" method="POST">
        <div class="input-group m-1">
          <input type="hidden" name="route" value="find_recipes">
          <input type="hidden" name="sorting_method" value={{ sorting_method }}>
          <input type="text" class="form-control" name="find_recipe"
            placeholder="Hae reseptiä nimellä. Tyhjä haku listaa kaikki reseptit.">
          <button type="submit" class="btn btn-dark btn-sm">HAE</button>
        </div>
      </form>
    </div>
  </div>

  <div class="row">
    <div class="col">
      <form action="/recipes" method="POST">
        <div class="input-group m-1">
          <input type="hidden" name="route" value="sort_recipes">
          <input type="hidden" name="query" value={{ query }}>
          <button name="sorting_btn" value="1" type="submit"
            class="btn btn-outline-{% if sorting_method == '1' %}primary{% else %}secondary{% endif %} btn-sm mx-1">
            UUSIN ENSIN
          </button>
          <button name="sorting_btn" value="2" type="submit"
            class="btn btn-outline-{% if sorting_method == '2' %}primary{% else %}secondary{% endif %} btn-sm mx-1">
            VANHIN ENSIN
          </button>
          <button name="sorting_btn" value="3" type="submit"
            class="btn btn-outline-{% if sorting_method == '3' %}primary{% else %}secondary{% endif %} btn-sm mx-1">
            PARHAITEN ARVIOITU ENSIN
          </button>
          <button name="sorting_btn" value="4" type="submit"
            class="btn btn-outline-{% if sorting_method == '4' %}primary{% else %}secondary{% endif %} btn-sm mx-1">
            HUONOITEN ARVIOITU ENSIN
          </button>
          <button name="sorting_btn" value="5" type="submit"
            class="btn btn-outline-{% if sorting_method == '5' %}primary{% else %}secondary{% endif %} btn-sm mx-1">
            ENITEN KATSELUITA ENSIN
          </button>
          <button name="sorting_btn" value="6" type="submit"
            class="btn btn-outline-{% if sorting_method == '6' %}primary{% else %}secondary{% endif %} btn-sm mx-1">
            VÄHITEN KATSELUITA ENSIN
          </button>
        </div>
      </form>
    </div>
  </div>

  {% for recipe in all_recipes %}
  <div class=" row">
    <div class="col">
      <div class="card m-1">
        <div class="card-body">
          <h5 class="card-title">{{ recipe[1] }}</h5>
          <h6 class="card-subtitle mb-2 text-muted">Ohjeen on luonut {{ recipe[7] }} ({{
            recipe[4].strftime("%Y-%m-%d") }})</h6>
          {% if recipe[9] == 0 %}
          <h6 class="card-subtitle mb-2 text-muted">Reseptillä ei ole vielä arvioita. Katsottu {{ recipe[10] }} kertaa.
          </h6>
          {% else %}
          <h6 class="card-subtitle mb-2 text-muted">Arvioiden keskiarvo {{ recipe[9]|round(1) }}. Katsottu {{ recipe[10]
            }} kertaa.</h6>
          {% endif %}
          <p class="card-text">{{ recipe[8] }}</p>
          <a href="{{ recipe[6] }}" class="btn btn-outline-dark">Katso resepti</a>
          {% if session.user_id == recipe[11] %}
          <a href="/recipe/edit/{{ recipe[0] }}" class="btn btn-outline-dark">Muokkaa reseptiä</a>
          {% endif %}

        </div>
      </div>
    </div>
  </div>
  {% endfor %}

</div>

{% endblock %}